rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 完全無料（Functionsなし）運用のため、編集制御は「秘密URL（クライアント側）」で行う。
    // Firestoreルールでは厳密な「管理者だけ編集」を担保できないため、
    // ここでは最低限「匿名Authでのアクセス必須」に留める（MVP）。
    function authed() { return request.auth != null; }

    match /tenants/{tenantId} {
      allow read: if authed();
      allow create, update, delete: if authed();

      match /areas/{areaId} {
        allow read: if authed();
        allow write: if authed();
      }

      match /staff/{staffId} {
        allow read: if authed();
        allow write: if authed();
      }

      match /days/{date} {
        allow read: if authed();

        match /state {
          allow read: if authed();
          allow write: if authed();
        }

        match /shifts/{staffId} {
          allow read: if authed();
          allow write: if authed();
        }

        match /assignments/{staffId} {
          allow read: if authed();
          allow write: if authed();
        }

        match /auditLogs/{logId} {
          allow read: if authed();
          allow create: if authed();
          allow update, delete: if authed();
        }
      }
    }
  }
}

