# 実装ロードマップ & チェックリスト（MVP v1.2）

最終更新: 2026-01-05  
対象仕様: `docs/requirements_mvp_v1.2.md`

運用ルール:
- ここで完了した作業は **[x]** に更新する
- 進行中は **(in progress)** を付ける
- 仕様変更が出たら「差分チケット」を追記し、影響範囲を明記する

---

## フェーズ0：準備（半日〜1日）
- [x] リポジトリ初期化（Next.js + TypeScript）
- [x] UI基盤（ルーティング、レイアウト、メニュー、iPad横向き前提のレスポンシブ）
- [x] 環境変数設計（Firebase設定、tenantIdの扱い）
- [ ] Firebaseプロジェクト準備（Firestore / Auth(匿名) / Hosting or Vercel）
- [x] ローカル開発手順をREADMEに記載（起動、エミュレータ、デプロイ）

成果物:
- `README.md` に「起動」「Firebase設定」「デプロイ」手順がある
- `/mapper` `/timeline` `/dashboard` `/history` `/staff` `/import` `/settings` が空でも表示できる

---

## フェーズ1：セキュリティ & 編集権限（1〜2日）
- [x] 匿名Authの自動ログイン（ログイン操作なし）
- [x] 管理者URL（秘密URL）で編集モードを表示（UI制御）
- [ ] Firestoreルール適用（最低限: 匿名Auth必須。完全無料のため厳密な編集制御は運用で担保）

受入:
- 閲覧URLでは編集UIが出ない
- 管理者用の秘密URLでは編集UIが出る

---

## フェーズ2：データモデル & 初期データ（1日）
- [ ] Firestoreコレクション構造の実装（tenants/areas/staff/days/*）
- [ ] 初期テナント/初期エリア投入（さる/へび/ランチ/うさぎ/とら/ねずみ + 園庭等 + フリー/休憩）
- [ ] 表示名生成（苗字、重複時は苗字+名の頭文字ローマ字1文字）

受入:
- 指定レイアウトのエリアが表示される（6カラム×3段 + 右サイド）

---

## フェーズ3：マッパー（コア機能）（2〜4日）
- [ ] マッパーUI（背景 + 6カラムグリッド配置 + 右サイド: フリー/休憩）
- [ ] エリア内の職員自動整列（CSS Grid）
- [ ] 編集ロック（state.editLocked のON/OFF）
- [ ] D&D配置変更（Firestore transaction + version 競合検知）
- [ ] 競合警告UI（同じ職員を同時に動かした時）
- [ ] 勤務終了グレー表示（endAt経過で視覚変更）
- [ ] 監査ログ記録（move/lock/unlock）

受入:
- 端末Aの移動が端末Bに反映
- 同一職員の同時移動で競合警告
- ロックONで編集不可

---

## フェーズ4：休憩（1〜2日）
- [ ] 休憩パターン（15+30 / 30+30）を職員に付与・表示
- [ ] 休憩開始（退勤30分前以降は不可）→休憩エリアへ移動 + 枠消化
- [ ] 未消化バッジ表示（休2/休1/休0）
- [ ] 監査ログ記録（break_start/break_end）

受入:
- 休憩開始で休憩へ移動、枠が減る
- 退勤30分前は開始できず理由が出る

---

## フェーズ5：Excel取込（1〜3日）
- [ ] `.xlsx` 取込（ブラウザ）
- [ ] 日付列特定（1行目日付）・氏名照合（1列目）・勤務コード抽出（A〜F）
- [ ] 当日 `shifts` の upsert（A〜F展開 / fixed適用）
- [ ] 取込エラーUI（未知コード/氏名未登録/日付列なし等）
- [ ] 監査ログ記録（import）

受入:
- Excelから当日の出勤者が生成できる（UIで確認できる）

---

## フェーズ6：ダッシュボード & 履歴（1〜2日）
- [ ] ダッシュボード4指標（総出勤/エリア別人数/休憩消化率/休憩中人数）
- [ ] 履歴画面（フィルタ付き）

受入:
- 数字が当日データから正しく算出される
- 履歴が参照できる

---

## フェーズ7：タイムバー（1〜2日）
- [ ] タイムバー画面（7:00〜19:00、15分刻み）
- [ ] 個人別勤務バー表示（startAt〜endAt）
- [ ] 勤務中人数推移（上段）
- [ ] 手薄ハイライト（minStaffThreshold未満）

受入:
- 7:00〜19:00で視覚的に「薄い時間」が分かる

---

## フェーズ8：オフライン（1〜2日）
- [ ] Firestoreオフライン永続化ON（IndexedDB）
- [ ] オフライン状態表示（バナー）
- [ ] オフライン編集→復帰同期（競合時は警告）

受入:
- 管理者端末がオフラインでも編集継続できる

---

## フェーズ9：仕上げ（1〜2日）
- [ ] iPad実機想定のUI微調整（タップ領域、スクロール、誤操作防止）
- [ ] 設定画面（最低人数しきい値、背景画像URL、PIN変更）
- [ ] 最低限のデータバックアップ導線（エクスポート/将来のアーカイブ方針メモ）
- [ ] 受入テスト実施（仕様書のチェックリストに準拠）

成果物:
- MVPが通しで動作（取込→配置→休憩→ダッシュボード→履歴→タイムバー）

